function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable;}));}ownKeys.forEach(function(key){_defineProperty(target,key,source[key]);});}return target;}var STD;(function(STD1){STD1.refreshRate=15;STD1.aspectRatio=16/9;STD1.resizeThreshold=5;STD1.resizeSpeed=0.25;})(STD||(STD={}));var Global=function(record){return _objectSpread({variation:'Global'},record);};var Local=function(record){return _objectSpread({variation:'Local'},record);};var main=Do.IO.bindto('present')(function(_){return I.time;}).bindto('idealCanvasWidth')(function(_){return I.windowWH.fmap(fsnd(mul(STD.aspectRatio))).fmap(uncurry(min));}).also(function($){return O.setCanvasWH($.idealCanvasWidth)($.idealCanvasWidth/STD.aspectRatio);}).bind(function($){return loop(Global({time:$.present,deltaTime:0,refreshTime:0,canvasWidth:$.idealCanvasWidth,isRefresh:false,isResizing:false}))(Local({}));});var loop=function(global){return function(local){return Do.IO.bindto('present')(function(_){return I.time;}).bindto('maxCanvasWidth')(function(_){return I.windowWH.fmap(fsnd(mul(STD.aspectRatio))).fmap(uncurry(min));}).bindto('nextIsResizing')(function($){return I.isWindowResized.fmap(function(b){return (b||global.isResizing)&&napprox(STD.resizeThreshold)($.maxCanvasWidth)(global.canvasWidth);});}).fmapto('nextDeltaTime')(function($){return $.present-global.time;}).fmapto('nextRefreshTime')(function($){return (global.isRefresh?0:global.refreshTime)+$.nextDeltaTime;}).fmapto('nextIsRefresh')(function($){return $.nextRefreshTime>STD.refreshRate;}).fmapto('nextGlobal')(function($){return Global({time:$.present,deltaTime:$.nextDeltaTime,refreshTime:$.nextRefreshTime,canvasWidth:$.nextIsResizing&&$.nextIsRefresh?lerp(STD.resizeSpeed)(global.canvasWidth)($.maxCanvasWidth):global.canvasWidth,isRefresh:$.nextIsRefresh,isResizing:$.nextIsResizing});}).bindto('nextLocal')(function($){return update($.nextGlobal)(local);}).also(function($){return $.nextIsResizing&&$.nextIsRefresh?O.setCanvasWH($.nextGlobal.canvasWidth)($.nextGlobal.canvasWidth/STD.aspectRatio):idle;}).also(function($){return render($.nextGlobal)($.nextLocal);}).side(O.resetState).bind(function($){return O.queue(loop($.nextGlobal)($.nextLocal));});};};var update=function(global){return function(local){return send(local);};};var render=function(global){return function(local){return idle;};};